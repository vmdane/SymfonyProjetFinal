{% extends 'base.html.twig' %}

{% block title %}Biblioth√®que - Liste des Books{% endblock %}

{% block body %}
<div class="min-h-screen bg-gradient-to-r from-indigo-100 via-white to-indigo-100 py-12 px-6 flex flex-col items-center">

  <!-- Header avec titre principal -->
  <header class="max-w-6xl w-full mb-12 text-center px-4 sm:px-0">
    <h1 class="text-6xl sm:text-7xl font-extrabold text-indigo-900 mb-4 drop-shadow-lg leading-tight">
      Liste des Books
    </h1>
    <p class="text-xl text-indigo-700 max-w-3xl mx-auto">
      D√©couvrez notre s√©lection de livres disponibles.
    </p>
  </header>

  <!-- Grille des livres -->
  <main class="max-w-6xl w-full grid gap-8 sm:gap-10 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 justify-center">

    {% if books|length > 0 %}
      {% set shuffledBooks = books|shuffle %}

      {% for book in shuffledBooks|slice(0, 50) %}
        <article class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-shadow duration-300 flex flex-col overflow-hidden group max-w-xs w-full mx-auto">

          <div class="relative h-48 overflow-hidden rounded-t-2xl bg-indigo-50">
            {% if book.imageCouverture %}
              <img
                src="{{ asset('images/' ~ book.imageCouverture) }}"
                alt="Couverture du livre {{ book.titre }}"
                class="object-cover w-full h-full transform group-hover:scale-105 transition-transform duration-300"
              >
            {% else %}
              <div class="flex items-center justify-center h-full text-indigo-400 text-7xl font-bold select-none">
                üìö
              </div>
            {% endif %}
            <span
              class="absolute top-3 right-3 px-3 py-1 text-xs font-semibold rounded-full
                     {{ book.disponible ? 'bg-green-200 text-green-900' : 'bg-red-200 text-red-900' }}"
              title="{{ book.disponible ? 'Disponible √† l‚Äôemprunt' : 'Indisponible actuellement' }}"
            >
              {{ book.disponible ? 'Disponible' : 'Emprunt√©' }}
            </span>
          </div>

          <div class="p-4 flex flex-col flex-grow overflow-visible">
            <h2
              class="text-lg sm:text-xl font-extrabold text-indigo-900 mb-1"
              title="{{ book.titre }}"
            >
              {{ book.titre }}
            </h2>

            <p class="text-xs sm:text-sm text-indigo-700 mb-1 font-semibold" title="Auteurs">
              <span class="opacity-75">Auteur{{ book.authors|length > 1 ? 's' : '' }} :</span>
              {% if book.authors|length > 0 %}
                {{ book.authors|map(a => a.name)|join(', ') }}
              {% else %}
                <em>Non renseign√©</em>
              {% endif %}
            </p>

            <p class="text-xs sm:text-sm text-indigo-600 mb-3" title="Cat√©gorie">
              <span class="opacity-75">Cat√©gorie{{ book.categories|length > 1 ? 's' : '' }} :</span>
              {% if book.categories|length > 0 %}
                {{ book.categories|map(c => c.name)|join(', ') }}
              {% else %}
                <em>Inconnue</em>
              {% endif %}
            </p>

            {% if book.disponible %}
              <form method="post" action="{{ path('app_book_emprunter', {'id': book.id}) }}" class="mt-auto mb-2">
                <input type="hidden" name="_token" value="{{ csrf_token('emprunter' ~ book.id) }}">
                <button
                  type="submit"
                  class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg py-2 text-sm transition-colors"
                >
                  Emprunter
                </button>
              </form>
            {% else %}
              <div class="mt-auto py-2 text-center text-red-600 font-semibold text-sm select-none">
                Indisponible
              </div>
            {% endif %}

            {% if app.user %}
              {% set isFavori = book in app.user.getFavorite() %}
              {% if isFavori %}
                <div class="mt-2 text-center text-green-700 font-semibold text-sm select-none">
                  ‚≠ê Favori
                </div>
              {% else %}
                <form method="post" action="{{ path('app_favoris_add', {'id': book.id}) }}" class="mt-auto">
                  <input type="hidden" name="_token" value="{{ csrf_token('add_favori' ~ book.id) }}">
                  <button
                    type="submit"
                    class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-semibold rounded-lg py-2 text-sm transition-colors"
                  >
                    Ajouter aux favorite
                  </button>
                </form>
              {% endif %}
            {% endif %}
          </div>
        </article>
      {% endfor %}
    {% else %}
      <p class="col-span-full text-center text-indigo-500 text-lg mt-16">
        Aucun livre disponible pour le moment.
      </p>
    {% endif %}

  </main>
</div>
{% endblock %}
