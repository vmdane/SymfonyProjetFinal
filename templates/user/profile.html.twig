{% extends 'base.html.twig' %}

{% block title %}Profil de {{ user.firstname }}{% endblock %}

{% block body %}
    <div class="min-h-screen bg-gradient-to-br from-indigo-100 via-white to-indigo-100 py-12 px-6">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-4xl font-bold text-indigo-800 mb-8 text-center">Profil de {{ user.firstname }} {{ user.name }}</h1>

            <!-- Infos personnelles -->
            <section class="mb-12 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-semibold text-indigo-700 mb-4">üë§ Informations personnelles</h2>
                <p><strong>Nom :</strong> {{ user.name }}</p>
                <p><strong>Pr√©nom :</strong> {{ user.firstname }}</p>
                <p><strong>Email :</strong> {{ user.email }}</p>
                <p><strong>Inscrit depuis :</strong> {{ user.createAt ? user.createAt|date('d/m/Y') : 'Date inconnue' }}</p>
            </section>

            <!-- Biblioth√®ques -->
            <section class="mb-12 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-semibold text-indigo-700 mb-4">üìö Mes biblioth√®ques</h2>
                {% if bookshelves|length > 0 %}
                    <ul class="list-disc list-inside text-indigo-700">
                        {% for shelf in bookshelves %}
                            <li>{{ shelf.name }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-indigo-500 italic">Aucune biblioth√®que pour le moment.</p>
                {% endif %}
            </section>

            <!-- Livres favoris -->
            <section class="mb-12 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-semibold text-indigo-700 mb-4">‚ù§Ô∏è Livres favoris</h2>
                {% if favorites|length > 0 %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                        {% for book in favorites %}
                            <article class="border border-indigo-300 rounded p-4 hover:shadow-lg transition">
                                <h3 class="font-semibold text-indigo-900">{{ book.title }}</h3>
                                <p class="text-sm text-indigo-600">{{ book.author }}</p>
                            </article>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-indigo-500 italic">Vous n'avez pas encore ajout√© de favoris.</p>
                {% endif %}
            </section>

            <!-- Pr√™ts en cours : Emprunts et Pr√™t√©s c√¥te √† c√¥te -->
            <section class="mb-12 bg-white p-6 rounded-xl shadow-md">
                <div class="flex flex-col md:flex-row gap-4 mt-6 justify-left">
                    <h2 class="text-2xl font-semibold text-indigo-700 mb-6">üìñ Pr√™ts en cours</h2>

                    <a href="{{ path('app_loan_index') }}" class="inline-block bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-3 rounded-lg shadow transition">
                        üìÑ Voir tous les pr√™ts
                    </a>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Emprunts -->
                    <div>
                        <h3 class="text-xl font-semibold text-indigo-600 mb-4">üì• Emprunts (max 5)</h3>
                        {% if borrowedLoans|length > 0 %}
                            <table class="min-w-full text-sm">
                                <thead>
                                <tr class="bg-indigo-100 text-indigo-800">
                                    <th class="py-2 px-4 text-left">Livre</th>
                                    <th class="py-2 px-4 text-left">D√©but</th>
                                    <th class="py-2 px-4 text-left">Retour</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for loan in borrowedLoans|slice(0, 5) %}
                                    <tr class="border-b hover:bg-indigo-50">
                                        <td class="py-2 px-4 font-medium text-indigo-700">
                                            <a href="{{ path('app_book_show', {'id': loan.book.id}) }}" class="hover:underline">
                                                {{ loan.book.title }}
                                            </a>
                                        </td>
                                        <td class="py-2 px-4">{{ loan.startDate ? loan.startDate|date('d/m/Y') : 'N/A' }}</td>
                                        <td class="py-2 px-4">{{ loan.returnDate ? loan.returnDate|date('d/m/Y') : 'N/A' }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p class="text-indigo-500 italic">Aucun emprunt.</p>
                        {% endif %}
                    </div>

                    <!-- Livres pr√™t√©s -->
                    <div>
                        <h3 class="text-xl font-semibold text-indigo-600 mb-4">üì§ Livres pr√™t√©s (max 5)</h3>
                        {% if lentLoans|length > 0 %}
                            <table class="min-w-full text-sm">
                                <thead>
                                <tr class="bg-indigo-100 text-indigo-800">
                                    <th class="py-2 px-4 text-left">Livre</th>
                                    <th class="py-2 px-4 text-left">√Ä</th>
                                    <th class="py-2 px-4 text-left">D√©but</th>
                                    <th class="py-2 px-4 text-left">Retour</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for loan in lentLoans|slice(0, 5) %}
                                    <tr class="border-b hover:bg-indigo-50">
                                        <td class="py-2 px-4 font-medium text-indigo-700">
                                            <a href="{{ path('app_book_show', {'id': loan.book.id}) }}" class="hover:underline">
                                                {{ loan.book.title }}
                                            </a>
                                        </td>
                                        <td class="py-2 px-4">{{ loan.borrower.firstname }} {{ loan.borrower.name }}</td>
                                        <td class="py-2 px-4">{{ loan.startDate ? loan.startDate|date('d/m/Y') : 'N/A' }}</td>
                                        <td class="py-2 px-4">{{ loan.returnDate ? loan.returnDate|date('d/m/Y') : 'N/A' }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p class="text-indigo-500 italic">Aucun livre pr√™t√©.</p>
                        {% endif %}
                    </div>
                </div>
            </section>



            <!-- Avis √©crits -->
            <section class="mb-12 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-semibold text-indigo-700 mb-4">üìù Avis √©crits</h2>
                {% if reviews|length > 0 %}
                    <ul class="space-y-4">
                        {% for review in reviews %}
                            <li class="border border-indigo-300 rounded p-4">
                                <strong>{{ review.book.title }}</strong> ‚Äî <em>{{ review.createdAt ? review.createdAt|date('d/m/Y') : 'Date inconnue' }}</em>
                                <p class="mt-2 text-indigo-700">{{ review.content|length > 200 ? review.content|slice(0, 200) ~ '...' : review.content }}</p>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-indigo-500 italic">Vous n'avez pas encore √©crit d'avis.</p>
                {% endif %}
            </section>
        </div>
    </div>
{% endblock %}
